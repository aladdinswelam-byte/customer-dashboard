<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Client Detail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{font-family:system-ui,Arial,Helvetica,sans-serif;margin:0;padding:1rem;background:#f5f7fa;color:#333}
    h2{margin-top:0}
    .badge{background:#1976d2;color:#fff;padding:.3rem .6rem;border-radius:4px;font-size:.9rem}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    th,td{padding:.6rem;text-align:left}
    th{background:#1976d2;color:#fff}
    tr:nth-child(even){background:#f2f2f2}
  </style>
</head>
<body>
  <h2 id="title"></h2>
  <p id="summary"></p>
  <p id="metrics"></p>
  <table id="detailTable">
    <thead><tr><th>Date</th><th>Restaurant</th><th>Payment</th><th>Amount</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const DATA_URL = 'https://raw.githubusercontent.com/aladdinswelam-byte/customer-dashboard/main/data.json';
    const wanted   = new URLSearchParams(location.search).get('phone')?.trim();

    fetch(DATA_URL)
      .then(r=>r.json())
      .then(allData=>{
        /* ----  normalise phone on BOTH sides  ---- */
        const rows = allData.filter(r=>{
          const ph = (r['Account Phones']||r['Phone']||'').toString().trim();
          return ph === wanted;
        });

        if (!rows.length){document.body.innerHTML='<h2>No data for phone '+wanted+'</h2>';return;}

        const name  = rows[0]['Account Name']||'—';
        const total = rows.reduce((s,r)=>s+parseFloat(r['Total Price']||0),0);
        const avg   = total/rows.length||0;

        /* ----  weekly frequency  ---- */
        const dates = rows.map(r=>new Date(r['Created']||r['OrderDate']||r['Created Date']||'')).sort((a,b)=>a-b);
        const daysSpan = (dates[dates.length-1] - dates[0]) / (1000*60*60*24) || 1;
        const ordersPerWeek = (rows.length / daysSpan) * 7;
        const weeklyText = ordersPerWeek < 1 ? 'Less than 1× per week' : `≈ ${ordersPerWeek.toFixed(1)}× per week`;

        document.getElementById('title').textContent   = `Client: ${name} – Phone: ${wanted}`;
        document.getElementById('summary').textContent = `Total order sum: ${total.toFixed(2)} | Average per order: ${avg.toFixed(2)} | Orders: ${rows.length}`;
        document.getElementById('metrics').innerHTML   = `<span class="badge">${weeklyText}</span>`;

        const tb = document.querySelector('#detailTable tbody');
        rows.forEach(r=>{
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td>${new Date(r['Created']||r['OrderDate']||r['Created Date']||'').toLocaleDateString()}</td>
            <td>${r['Resturant']||r['Restaurant']||''}</td>
            <td>${r['Payment Method']||''}</td>
            <td>${parseFloat(r['Total Price']||0).toFixed(2)}</td>`;
          tb.appendChild(tr);
        });
      })
      .catch(err=>{
        document.body.innerHTML='<h2>Error loading data</h2>';
        console.error(err);
      });
  </script>
</body>
</html>
