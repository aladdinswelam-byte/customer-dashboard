<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Smart-Filter Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body{font-family:system-ui,Arial,Helvetica,sans-serif;margin:0;padding:1rem;background:#f5f7fa;color:#333}
    h1{text-align:center;margin-top:0}
    #dynFilters{display:flex;flex-wrap:wrap;gap:.6rem;margin-bottom:1rem}
    #dynFilters label{background:#fff;padding:.5rem;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);font-size:.85rem}
    select,input{padding:.4rem;border:1px solid #bbb;border-radius:4px}
    button{background:#1976d2;color:#fff;border:none;padding:.6rem 1.2rem;border-radius:4px;cursor:pointer}
    button:hover{background:#1565c0}
    #stats{margin-bottom:.5rem;font-weight:500}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    th,td{padding:.6rem;text-align:left}
    th{background:#1976d2;color:#fff}
    tr:nth-child(even){background:#f2f2f2}
    .phone-table{margin-top:.8rem}
    @media(max-width:700px){body{padding:.5rem} #dynFilters{flex-direction:column}}
  </style>
</head>
<body>
  <h1>Restaurant Dashboard</h1>

  <input type="file" id="fileInput" accept=".xlsx,.xls"/>

  <!-- dynamic filters will be injected here -->
  <div id="dynFilters"></div>

  <button id="applyBtn">Apply filters</button>

  <div id="stats"></div>

  <!-- master phone list -->
  <table id="phoneTable">
    <thead>
      <tr>
        <th>Phone</th><th>Account Name</th><th>Orders</th><th>Total</th><th>Avg</th><th>Last order</th><th>Days ago</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- detail table for chosen phone -->
  <div id="phoneDetail"></div>

  <script>
    let rawRows=[], aggPhones=[], uniqueOptions={};

    const today=new Date();

    document.getElementById('fileInput').addEventListener('change', handleFile);
    document.getElementById('applyBtn').addEventListener('click', applyAllFilters);

    function handleFile(e){
      const file=e.target.files[0];
      const reader=new FileReader();
      reader.onload=evt
